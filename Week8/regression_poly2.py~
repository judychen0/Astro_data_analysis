import numpy as np
import astropy.io.fits as pf
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import importlib
import scipy.stats as ss
from scipy.optimize import curve_fit
from kapteyn import kmpfit

data = pf.getdata('Simple_mass_metallicity_210927.fits', 1)
x_all = data['mass'].astype('float64')
y_all = data['OH'].astype('float64')

def residual(p, data):
    x, y = data
    a, b, c = p
    return(y-(a*x**2+b*x+c))

fitobj = kmpfit.Fitter(residuals=residual, data=(x_all, y_all))
parinit = [-1, 0, 9]
fitobj.fit(params0 = parinit)
optpar = fitobj.params
print("fit result : %0.2fx^2 + %0.2fx + %0.2f" % (optpar[0], optpar[1], optpar[2]))
